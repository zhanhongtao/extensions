<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
</head>
<body>
<script>
function createTab(src, tab) {
  sogouExplorer.tabs.create({
    index: ++tab.index,
    url: src,
    active: true,
    selected: true
  });
}

function downFromFlvcd(src, tab) {
  var api = 'http://www.flvcd.com/parse.php?';
  var config = {
    format: 'super', // real/super/high
    flag: 'one',
    kw: encodeURIComponent(src)
  };
  api += Object.keys(config).map(function(key) {
    return key + '=' + config[key];
  }).join('&');
  createTab(api, tab);
}

function downFromClipconverter(src, tab) {
  var api = 'http://www.clipconverter.cc/?ref=addon&version=141&browser=userscript&url=';
  api += encodeURIComponent(src);
  createTab(api, tab);
}

function dox(src, tab) {
  var pattern = /^https?:\/\/(www\.)?youtube\.com/i;
  if (pattern.test(src)) {
    downFromClipconverter(src, tab);
  } else {
    downFromFlvcd(src, tab);
  }
}

sogouExplorer.sidebarAction.onClicked.addListener(function() {
  sogouExplorer.tabs.getSelected(function(tab) {
    dox(tab.url, tab);
  });
});
</script>
</body>
</html>